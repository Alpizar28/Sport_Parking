# SECURITY CONFIGURATION GUIDE
# ============================
# This file documents security best practices for environment variables

# CRITICAL: Never commit .env.local or .env files to version control
# Add them to .gitignore immediately

# ============================================================================
# SUPABASE CONFIGURATION
# ============================================================================

# Public keys - Safe to expose in client-side code
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key

# CRITICAL: Service Role Key - NEVER expose to client
# This key bypasses Row Level Security (RLS)
# Only use server-side in API routes
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# ============================================================================
# SITE CONFIGURATION
# ============================================================================

# Production URL (for OAuth callbacks, password reset, etc.)
NEXT_PUBLIC_SITE_URL=https://your-production-domain.com

# ============================================================================
# SECURITY BEST PRACTICES
# ============================================================================

# 1. ENVIRONMENT SEPARATION
#    - Use different Supabase projects for dev/staging/production
#    - Never use production credentials in development
#    - Rotate keys regularly (every 90 days minimum)

# 2. KEY ROTATION SCHEDULE
#    - Service Role Key: Every 90 days
#    - Anon Key: When compromised or annually
#    - Database passwords: Every 90 days

# 3. ACCESS CONTROL
#    - Limit who has access to production environment variables
#    - Use Vercel's environment variable encryption
#    - Enable 2FA for all team members with production access

# 4. MONITORING
#    - Enable Supabase audit logs
#    - Monitor for unusual API usage patterns
#    - Set up alerts for failed authentication attempts

# 5. BACKUP
#    - Store encrypted backups of environment variables
#    - Document key rotation procedures
#    - Maintain emergency access procedures

# ============================================================================
# VERCEL DEPLOYMENT SECURITY
# ============================================================================

# When deploying to Vercel:
# 1. Add environment variables through Vercel dashboard
# 2. Mark sensitive variables as "Sensitive" (encrypted at rest)
# 3. Limit environment variable access to specific environments
# 4. Enable "Automatically expose System Environment Variables" only if needed

# ============================================================================
# SUPABASE AUTH SECURITY SETTINGS
# ============================================================================

# Enable these in Supabase Dashboard > Authentication > Settings:
# ✅ Email confirmation required
# ✅ Leaked password protection (HaveIBeenPwned)
# ✅ Password strength requirements (min 8 chars, complexity)
# ✅ Rate limiting on auth endpoints
# ✅ Session timeout (recommended: 1 week)
# ✅ Refresh token rotation

# ============================================================================
# DATABASE SECURITY CHECKLIST
# ============================================================================

# ✅ Row Level Security (RLS) enabled on all tables
# ✅ No policies with USING (true) for INSERT/UPDATE/DELETE
# ✅ Functions use SET search_path = public, pg_temp
# ✅ SECURITY DEFINER functions are minimal and audited
# ✅ No direct database access from client (use API routes)
# ✅ Prepared statements used to prevent SQL injection
# ✅ Input validation on all user inputs
# ✅ Output sanitization for XSS prevention

# ============================================================================
# INCIDENT RESPONSE PLAN
# ============================================================================

# If credentials are compromised:
# 1. Immediately rotate all affected keys in Supabase dashboard
# 2. Review audit logs for unauthorized access
# 3. Force logout all users (reset JWT secret)
# 4. Update environment variables in all deployment environments
# 5. Review and update RLS policies if needed
# 6. Document incident and lessons learned

# ============================================================================
# COMPLIANCE NOTES
# ============================================================================

# GDPR Compliance:
# - User data retention policy: [DEFINE YOUR POLICY]
# - Data deletion process: [DEFINE YOUR PROCESS]
# - Data export capability: [IMPLEMENT IF NEEDED]

# PCI DSS (if handling payments):
# - Never store credit card numbers
# - Use tokenization for payment processing
# - Implement proper encryption for sensitive data
